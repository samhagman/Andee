name = "claude-sandbox-worker"
main = "src/index.ts"
compatibility_date = "2024-12-01"

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ IMPORTANT: This port must match SANDBOX_WORKER_URL in                  │
# │ ../claude-telegram-bot/.env                                            │
# └─────────────────────────────────────────────────────────────────────────┘
[dev]
port = 8787

# Durable Object binding for Sandbox
[durable_objects]
bindings = [
  { name = "Sandbox", class_name = "Sandbox" }
]

# Migrations - Sandbox requires SQLite storage
[[migrations]]
tag = "v1"
new_sqlite_classes = ["Sandbox"]

# Container configuration (wrangler 4.x format)
# Instance types: lite (1/16 vCPU), basic (1/4), standard-1 (1/2),
#                 standard-2 (1 vCPU), standard-3 (2), standard-4 (4)
[[containers]]
class_name = "Sandbox"
image = "./Dockerfile"
instance_type = "standard-4"  # 4 vCPU, 12 GiB RAM, 20 GB disk (max available)

# R2 binding for transcript persistence (optional enhancement)
[[r2_buckets]]
binding = "TRANSCRIPTS"
bucket_name = "andee-transcripts"

# R2 binding for session storage (shared with telegram bot)
[[r2_buckets]]
binding = "SESSIONS"
bucket_name = "andee-sessions"

# R2 binding for filesystem snapshots (backup/restore workspace)
[[r2_buckets]]
binding = "SNAPSHOTS"
bucket_name = "andee-snapshots"

# Import .script.js files as raw text (for container scripts)
# These scripts run inside Docker containers, not in the Worker runtime
[[rules]]
type = "Text"
globs = ["**/*.script.js"]
fallthrough = true
